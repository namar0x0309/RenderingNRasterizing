<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>NA::Rasterizer Embed</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        background: transparent;
      }
      #renderContext {
        width: 100%;
        max-width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      canvas {
        display: block;
        max-width: 100%;
        height: auto;
        background: #b5b5b5;
      }
    </style>

    <script src="Source/Types.js"></script>
    <script src="Source/Math.js"></script>
    <script src="Source/Mesh.js"></script>
    <script src="Source/Camera.js"></script>
    <script src="Source/ContextCanvas.js"></script>
    <script src="Assets/Cube.js"></script>

    <script>
      var radian = 0;
      var camDist = 10;
      var mesh = null;

      function onLoad() {
        CanvasCreate(GLOBAL.WIDTH, GLOBAL.HEIGHT, "canvas", "renderContext");
        contextCanvas = new ContextCanvas("canvas");

        mesh = MeshLibrary.Cube();
        contextCanvas.state.point.size = 5;

        loop();
      }

      function onMouseMove(e) {
        if (IE) {
          contextCanvas.mouse2d[0] = event.clientX + document.body.scrollLeft;
          contextCanvas.mouse2d[1] = event.clientY + document.body.scrollTop;
        } else {
          contextCanvas.mouse2d[0] = e.pageX;
          contextCanvas.mouse2d[1] = e.pageY;
        }

        if (contextCanvas.mouse2d[0] < 0) contextCanvas.mouse2d[0] = 0;
        if (contextCanvas.mouse2d[1] < 0) contextCanvas.mouse2d[1] = 0;

        return true;
      }

      function loop() {
        contextCanvas.DrawingSurfaceAlloc();

        contextCanvas.Print2D("Nassim Amar", [0, 10]);
        contextCanvas.Print2D("NA::Rasterizer", [0, 20]);
        contextCanvas.Print2D("FPS: " + contextCanvas.getFPS().toFixed(1), [0, 30]);
        contextCanvas.Print2D("Mouse(x,y): " + contextCanvas.mouse2d.toString(), [0, 40]);
        contextCanvas.Print2D("Cam(x,y,z): " + contextCanvas.camera.loc.toString(), [0, 50]);

        radian += 0.04;
        if (radian > Math.PI * 2) radian = 0;

        var theta = (2 * -Math.PI * contextCanvas.mouse2d[0]) / GLOBAL.WIDTH;
        var phi = (Math.PI * contextCanvas.mouse2d[1]) / GLOBAL.HEIGHT;

        contextCanvas.camera.LookAt(
          [Math.cos(theta) * camDist, 5, Math.sin(phi) * camDist],
          [0, 0, 0]
        );

        contextCanvas.Enable(contextCanvas.STATE.RENDER.LINE);

        mesh.transform.setRot([0, radian, 0]);
        mesh.transform.setScl([6, 6, 6]);
        mesh.transform.setLoc([0, 0, 0]);

        contextCanvas.Draw3DMesh(mesh);

        contextCanvas.Enable(contextCanvas.STATE.RENDER.VERTEX);
        contextCanvas.Enable(contextCanvas.STATE.DEBUG.VERTEXNUMBERS);
        contextCanvas.Draw3DMesh(mesh);

        contextCanvas.DrawingSurfaceDisplay();
        contextCanvas.Update(loop);
      }

      window.addEventListener("load", onLoad);
    </script>
  </head>
  <body>
    <div id="renderContext"></div>
  </body>
</html>
